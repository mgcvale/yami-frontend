var V=(l,t,o)=>new Promise((n,c)=>{var e=i=>{try{u(o.next(i))}catch(p){c(p)}},d=i=>{try{u(o.throw(i))}catch(p){c(p)}},u=i=>i.done?n(i.value):Promise.resolve(i.value).then(e,d);u((o=o.apply(l,t)).next())});import{D as et}from"../chunks/D4ODo2ld.js";import{e as Pt}from"../chunks/C3_eTjx-.js";import{l as Mt}from"../chunks/DN7I8fko.js";import{I as Et,e as xt,f as _t,c as J,a as wt,X as jt,m as Y,g as ot,b as $t,d as Ct}from"../chunks/tpmtnrJv.js";import{i as Dt}from"../chunks/N6ixcPMQ.js";import{h as bt,B as yt}from"../chunks/Dx98FtbP.js";import{i as It,E as mt}from"../chunks/BtRaPuvF.js";import{i as Tt}from"../chunks/CqBOX26c.js";import"../chunks/COm6N4YE.js";import{p as ct,h as At,a as F,g as Ft,b as g,c as ft,j as zt,f as w,d as a,r,t as z,s,n as Rt,V as kt,l as U,m as ut,o as st}from"../chunks/FcNz6uVe.js";import{s as _}from"../chunks/CQT1G1Sl.js";import{i as it}from"../chunks/7ms9Oyq9.js";import{d as Ot,e as gt,f as Wt}from"../chunks/BsEKk5dv.js";import{s as Bt,r as Ht,p as Nt,b as Lt,a as qt}from"../chunks/BdHP4ea0.js";import{C as nt}from"../chunks/Bm_8EKST.js";import{H as Gt,C as pt}from"../chunks/CFPIfavj.js";import{s as tt}from"../chunks/Cb4E-4CT.js";import{R as Ut}from"../chunks/VED0w991.js";import{c as Vt}from"../chunks/BWmCwwzs.js";import"../chunks/BQspDZ5E.js";import"../chunks/vsAJmYaO.js";import{D as Yt,E as Jt,P as Kt,T as Xt,H as Qt,F as Zt,C as te,d as ee,S as ae}from"../chunks/CUUdhvzw.js";import{s as lt}from"../chunks/Bya-iZhh.js";import{C as re}from"../chunks/DQJhOXeN.js";import{g as oe}from"../chunks/QXgKwo3K.js";import{I as ht}from"../chunks/BtsYN2KJ.js";function se(l,t){ct(t,!0);let o=Ht(t,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M10 18h4"}],["path",{d:"M11 6H3"}],["path",{d:"M15 6h6"}],["path",{d:"M18 9V3"}],["path",{d:"M7 12h8"}]];Et(l,Bt({name:"list-filter-plus"},()=>o,{get iconNode(){return n},children:(c,e)=>{var d=At(),u=F(d);Ft(u,()=>{var i;return(i=t.children)!=null?i:zt}),g(c,d)},$$slots:{default:!0}})),ft()}function ie(l){return V(this,null,function*(){try{const t=yield xt(yield _t(J.apiPaths.foodStats(l),{method:"GET"},J.fetchTimeout));if(!Dt(t))throw console.log(t),et.BAD_RESPONSE;return wt(t)}catch(t){return bt(t)}})}function ne(l){return V(this,null,function*(){try{const t=yield xt(yield _t(J.apiPaths.foodReviews(l),{method:"GET"},J.fetchTimeout));if(!Tt(t,It))throw et.BAD_RESPONSE;return wt(t)}catch(t){return bt(t)}})}const le=l=>V(null,null,function*(){var d,u;yield l.parent();const t=parseInt((d=l.url.searchParams.get("id"))!=null?d:"-1");if(t==-1)throw Pt(et.INVALID_PAGE_PARAMS.status,et.INVALID_PAGE_PARAMS);const o=yield Mt(t);if(o.error)throw o.error.status,o.error;const n=yield ie(t);if(n.error)throw n.error.status,n.error;const c={ratingDistribution:n.data,averageRating:(u=o.data)==null?void 0:u.avgRating},e=yield ne(t);if(e.error)throw e.error.status,e.error;return{food:o.data,foodStats:c,reviews:e.data}}),Xe=Object.freeze(Object.defineProperty({__proto__:null,load:le},Symbol.toStringTag,{value:"Module"}));var de=w("<span> </span>");function dt(l,t){Nt(t,"className",3,"");var o=de(),n=a(o);r(o),z(()=>{tt(o,1,`whitespace-nowrap text-md font-bold
    ${t.rating===20?"text-rating-top":t.rating>=15?"text-rating-great":t.rating>=10?"text-rating-good":t.rating>=5?"text-rating-bad":"text-rating-terrible"}`),_(n,`${t.rating/2} / 10`)}),g(l,o)}var ce=w('<div><span> </span> <span class="px-2 text-xl">•</span> <span> </span></div>');function fe(l,t){function o(i){const p=h=>{const H=.254829592,X=-.284496736,Q=1.421413741,Z=-1.453152027,at=1.061405429,rt=.3275911,f=h<0?-1:1;h=Math.abs(h);const y=1/(1+rt*h),P=1-((((at*y+Z)*y+Q)*y+X)*y+H)*y*Math.exp(-h*h);return f*P};i=Math.max(0,Math.min(20,i));const W=(i-10)/(3.5*Math.sqrt(2)),B=.5*(1+p(W));return`Top ${Math.max(1,Math.round((1-B)*100))}%`}var n=ce(),c=a(n),e=a(c);r(c);var d=s(c,4),u=a(d,!0);r(d),r(n),z(i=>{var p;tt(n,1,`flex items-center justify-start ps-1 ${(p=t.className)!=null?p:""}`),tt(c,1,`whitespace-nowrap text-lg font-bold
        ${t.rating===20?"text-rating-top":t.rating>=15?"text-rating-great":t.rating>=10?"text-rating-good":t.rating>=5?"text-rating-bad":"text-rating-terrible"}`),_(e,`${t.rating/2} / 10`),tt(d,1,`whitespace-nowrap text-lg font-bold
        ${t.rating===20?"text-rating-top":t.rating>=15?"text-rating-great":t.rating>=10?"text-rating-good":t.rating>=5?"text-rating-bad":"text-rating-terrible"}`),_(u,i)},[()=>o(t.rating)]),g(l,n)}var ve=w('<div class="p-2 pt-0 relative"><!> <h1 class="font-alegreya text-2xl"> </h1> <h2 class="text-lm"><!> </h2> <!> <p class="text-sm pb-2"> </p> <div class="flex items-center justify-end"><!></div></div>');function me(l,t){ct(t,!0);var o=ve(),n=a(o);jt(n,{size:16,strokeWidth:2.5,class:"absolute top-2.5 right-2.5",onclick:()=>Y.set(null)});var c=s(n,2),e=a(c);r(c);var d=s(c,2),u=a(d);dt(u,{get rating(){return t.review.rating},className:"text-sm font-medium font-alegreya"});var i=s(u);r(d);var p=s(d,2);Yt(p,{lineClassName:"bg-light-card-3 dark:bg-dark-card-2",containerClassName:"px-0.5 py-4 max-w-32 m-auto"});var O=s(p,2),K=a(O,!0);r(O);var W=s(O,2),B=a(W);yt(B,{onclick:()=>Y.set(null),className:"px-4",children:(S,h)=>{Rt();var H=kt("OK");g(S,H)},$$slots:{default:!0}}),r(W),r(o),z(()=>{var S,h;_(e,`${(S=t.review.username)!=null?S:""}'s Review`),_(i,` to ${(h=t.review.foodName)!=null?h:""}`),_(K,t.review.review)}),g(l,o),ft()}var ue=w('<img alt="Food" class="rounded-lg aspect-square object-cover flex-1 min-w-0 self-start max-w-32"/>'),ge=w('<div class="flex rounded-lg aspect-square object-cover items-center justify-center flex-1 min-w-0 self-start max-w-32 w-32"><!></div>'),pe=w('<div class="flex justify-start items-stretch gap-3 w-full min-w-0"><!> <div class="flex flex-col flex-shrink-0"><h3 class="font-alegreya text-lg"> </h3> <a class="underline"> </a> <div class="flex-1 flex flex-col justify-center"><!></div></div></div> <p class="text-ms"> </p> <!>',1),he=w('<h2 class="text-lm pb-2"><!> </h2> <p class="text-sm pb-2"> </p>',1),xe=w('<div class="flex justify-between pb-3 px-1"><h3 class="font-alegreya text-lg">Your review</h3> <div class="flex relative"><!> <!></div></div> <!>',1),_e=(l,t,o)=>t(U(o)),we=w('<div class="h-full  aspect-square pr-3 flex items-center justify-center"><!></div> <div class="flex flex-col items-start justify-start dark:text-dark-fg-300 text-light-fg-300 "><h2> </h2> <h2>Rating: <!></h2></div> <div class="flex-grow"></div> <div class="flex flex-col justify-between items-center"><!></div>',1),be=w('<div role="button" class="w-full"><!></div>'),ye=w('<div class="flex w-full justify-between pb-2 px-1"><h3 class="font-alegreya text-lg">Latest reviews</h3> <!></div> <!>',1),Re=w('<!> <div class="flex flex-col w-full items-center justify-start p-3 pt-1 gap-3"><!> <!> <!> <!></div>',1);function Qe(l,t){ct(t,!0);const[o,n]=Lt(),c=()=>qt(Vt,"$currentUserStore",o);let e=Nt(t,"data",7),d=ut(!1);const u=[{name:"Edit",icon:Kt,action:p},{name:"Delete",icon:Xt,action:O,className:"text-light-error dark:text-dark-error"}];function i(f){console.log(f),Y.set({component:me,props:{review:f}})}function p(){e().food.review&&Y.set({component:Zt,props:{review:e().food.review}})}function O(){Y.set({component:te,props:{actionName:"Delete this review",action:f=>{f&&K()}}})}function K(){return V(this,null,function*(){if(!e().food.review)return;const f=yield ee(e().food.review.id);f.error!==null?lt.set({component:mt,props:{warningMessage:`Error deleting your review: ${f.error.message}`}}):(lt.set({component:ae,props:{successMessage:"Success deleting your review!"}}),e().food.review=void 0,location.reload())})}function W(){c().data===null&&lt.set({component:mt,props:{warningMessage:"You have to be logged in to create a review."}}),oe(`/app/review/create?foodId=${e().food.id}`)}let B=ut(!1);console.log(e().food);var S=Re(),h=F(S);Gt(h,{title:"Food Information"});var H=s(h,2),X=a(H);nt(X,{className:"flex flex-col items-start justify-start max-w-full w-full gap-2",children:(f,y)=>{var P=pe(),b=F(P),M=a(b);{var L=v=>{var m=ue();z(N=>ot(m,"src",N),[()=>J.apiPaths.foodImage(e().food.id)]),gt("error",m,()=>st(B,!0)),Wt(m),g(v,m)},q=v=>{var m=ge(),N=a(m);ht(N,{size:96,strokeWidth:1,class:"m-auto"}),r(m),g(v,m)};it(M,v=>{U(B)?v(q,!1):v(L)})}var R=s(M,2),$=a(R),x=a($);r($);var C=s($,2),E=a(C,!0);r(C);var D=s(C,2),I=a(D);fe(I,{get rating(){return e().food.avgRating},className:""}),r(D),r(R),r(b);var k=s(b,2),G=a(k);r(k);var T=s(k,2);{var j=v=>{yt(v,{className:"w-full",onclick:()=>W(),children:(m,N)=>{Rt();var A=kt("Review this food");g(m,A)},$$slots:{default:!0}})};it(T,v=>{e().food.review===null&&v(j)})}z(v=>{var m,N,A;_(x,`${(m=e().food.restaurantShortName)!=null?m:""}'s ${(N=e().food.name)!=null?N:""}`),ot(C,"href",`/app/restaurant?id=${e().food.restaurantId}`),_(E,e().food.restaurantName),_(G,`R$1,00 • ${(A=e().food.description)!=null?A:""}${v!=null?v:""}`)},[()=>e().food.description.endsWith(".")?"":"."]),g(f,P)},$$slots:{default:!0}});var Q=s(X,2);Ut(Q,{get name(){return e().food.name},get stats(){return e().foodStats},className:""});var Z=s(Q,2);{var at=f=>{nt(f,{className:"w-full p-3!",children:(y,P)=>{var b=xe(),M=F(b),L=s(a(M),2),q=a(L);Jt(q,{size:20,onclick:()=>setTimeout(()=>st(d,!0))});var R=s(q,2);re(R,{get entries(){return u},className:"bg-light-card-2! dark:bg-dark-card-2!",get showing(){return U(d)},set showing(x){st(d,x,!0)}}),r(L),r(M);var $=s(M,2);pt($,{className:"flex justify-start flex-col items-start rounded-lg w-full px-3! py-2! cursor-pointer",children:(x,C)=>{var E=he(),D=F(E),I=a(D);dt(I,{get rating(){return e().food.review.rating},className:"text-sm font-medium font-alegreya"});var k=s(I);r(D);var G=s(D,2),T=a(G,!0);r(G),z(()=>{var j;_(k,` to ${(j=e().food.name)!=null?j:""}`),_(T,e().food.review.review)}),g(x,E)},$$slots:{default:!0}}),g(y,b)},$$slots:{default:!0}})};it(Z,f=>{e().food.review!==null&&e().food.review!==void 0&&f(at)})}var rt=s(Z,2);nt(rt,{className:"flex flex-col justify-center items-center w-full p-3! gap-3",children:(f,y)=>{var P=ye(),b=F(P),M=s(a(b),2);se(M,{class:"cursor-pointer"}),r(b);var L=s(b,2);$t(L,17,()=>e().reviews.content,Ct,(q,R,$)=>{var x=be();x.__click=[_e,i,R],ot(x,"tabindex",$);var C=a(x);pt(C,{className:"flex justify-start items-center rounded-lg w-full px-3! py-2! cursor-pointer",children:(E,D)=>{var I=we(),k=F(I),G=a(k);ht(G,{size:32}),r(k);var T=s(k,2),j=a(T),v=a(j);r(j);var m=s(j,2),N=s(a(m));dt(N,{get rating(){return U(R).rating},className:""}),r(m),r(T);var A=s(T,4),St=a(A);Qt(St,{size:16,strokeWidth:3}),r(A),z(()=>{var vt;return _(v,`Review  by ${(vt=U(R).username)!=null?vt:""}`)}),g(E,I)},$$slots:{default:!0}}),r(x),gt("keypress",x,E=>{E.key==="enter"&&i(U(R))}),g(q,x)}),g(f,P)},$$slots:{default:!0}}),r(H),g(l,S),ft(),n()}Ot(["click"]);export{Qe as component,Xe as universal};
