var T=(n,u,o)=>new Promise((e,l)=>{var v=i=>{try{c(o.next(i))}catch(h){l(h)}},m=i=>{try{c(o.throw(i))}catch(h){l(h)}},c=i=>i.done?e(i.value):Promise.resolve(i.value).then(v,m);c((o=o.apply(n,u)).next())});import"../chunks/COm6N4YE.js";import{p as Y,o as a,f as b,a as I,b as w,c as G,m as p,d as C,s as d,r as O,l as t,X as H,n as L,V as X,t as q,W as z}from"../chunks/FcNz6uVe.js";import{s as Q}from"../chunks/CQT1G1Sl.js";import{i as Z}from"../chunks/7ms9Oyq9.js";import{a as $,b as ee,c as re,B as te}from"../chunks/Dx98FtbP.js";import{C as W}from"../chunks/Bm_8EKST.js";import{L as ae}from"../chunks/CQ_J3efe.js";import{T as j}from"../chunks/CAS4DjvC.js";import{M as oe}from"../chunks/BQspDZ5E.js";import{g as se}from"../chunks/QXgKwo3K.js";import{c as R,e as ne,f as le,s as x,a as ie,i as ce}from"../chunks/tpmtnrJv.js";import{c as ue}from"../chunks/BWmCwwzs.js";import{D as E}from"../chunks/D4ODo2ld.js";import{w as me}from"../chunks/BsEKk5dv.js";import{a as fe}from"../chunks/BqIH7s4d.js";import{v as de}from"../chunks/B6FbEGtQ.js";import{l as ge}from"../chunks/CoYuMvfO.js";import{E as pe,a as ve}from"../chunks/i4bjYeuP.js";function he(n){return de(n,{id:"number",username:"string",email:"string",accessToken:"string",bio:"string",location:"string",followerCount:"number",followingCount:"number",reviewCount:"number"})}const we=me({data:null,loading:!0,error:null});function xe(n,u){return n.length===0?["The username/email can't be empty","",!1]:u.length===0?["","The password can't be empty",!1]:["","",!0]}function _e(n,u){return T(this,null,function*(){const o=JSON.stringify({[n.match(R.emailRegex)?"email":"username"]:n,password:u});try{ge(()=>{});const e=yield ne(yield le(R.apiPaths.login(),{method:"POST",body:o},R.fetchTimeout));if(console.log(e),!he(e))return $(E.BAD_RESPONSE),x(E.BAD_RESPONSE);fe.set("accessToken",e.accessToken,{expires:180});const l={id:e.id,username:e.username,email:e.email,accessToken:e.accessToken,bio:e.bio,location:e.location,followerCount:e.followerCount,followingCount:e.followingCount,reviewCount:e.reviewCount,following:!1};return ue.set({data:l,loading:!1,error:null}),localStorage.setItem("currentUser",JSON.stringify(l)),se("/app",{replaceState:!0,invalidateAll:!0}),ie(null)}catch(e){return ce(e)?[401,409].includes(e.status)?x(e):($(e),x(e)):e instanceof TypeError?(ee(),x(E.NETWORK_ERROR)):(re(e),x(E.NETWORK_ERROR))}})}var ye=b('<p class="text-light-error dark:text-dark-error text-sm text-center"> </p>'),Ee=b('<header class="flex flex-col align-center justify-center h-14"><!></header> <div class="flex flex-col gap-4 items-center mt-4 mb-1"><h2 class="font-alegreya text-2xl pb-3">Welcome back!</h2> <!> <!> <!> <!></div>',1),be=b(`<div class="items-center text-center"><p>Don't have an account?</p> <a href="/account/register" class="underline text-light-fg-100 dark:text-dark-fg-100">Register instead</a></div> <div class="items-center text-center"><p>Don't want to log in?</p> <a href="/app" class="underline text-light-fg-100 dark:text-dark-fg-100">Return to yami</a></div>`,1),ke=b("<!> <!> <!>",1);function Ke(n,u){Y(u,!0);let o=p(""),e=p(""),l=p(""),v=p(""),m=p(""),c=p(!0),i=H(()=>t(c)?pe:ve);const h=()=>{a(c,!t(c))};function B(){return T(this,null,function*(){let s;if((g=>{var f=z(g,3);a(e,f[0],!0),a(v,f[1],!0),s=f[2]})(xe(t(o),t(l))),!s)return;console.log("going");const _=yield _e(t(o),t(l));if(_.error!==null)switch(_.error.status){case 401:a(m,"Your username or password is incorrect! Verify your credentials and try again.")}})}we.subscribe(s=>{if(!s.loading&&(a(m,""),s.error!==null))if(s.error.status===401){a(m,"Your username or password are incorrect.");return}else $(s.error)});var N=ke(),S=I(N);W(S,{children:(s,_)=>{var g=Ee(),f=I(g),F=C(f);ae(F,{className:"w-full h-auto"}),O(f);var M=d(f,2),P=d(C(M),2);j(P,{placeholder:"Username or Email",className:"w-80 max-w-full",noDecoration:!0,get value(){return t(o)},set value(r){a(o,r,!0)},get errorMessage(){return t(e)},set errorMessage(r){a(e,r,!0)}});var A=d(P,2);j(A,{placeholder:"Password",className:"w-80 max-w-full",noDecoration:!0,onIconClick:h,get value(){return t(l)},set value(r){a(l,r,!0)},get password(){return t(c)},set password(r){a(c,r,!0)},get icon(){return t(i)},set icon(r){a(i,r,!0)},get errorMessage(){return t(v)},set errorMessage(r){a(v,r,!0)}});var U=d(A,2);{var K=r=>{var y=ye(),k=C(y,!0);O(y),q(()=>Q(k,t(m))),w(r,y)};Z(U,r=>{t(m)&&r(K)})}var V=d(U,2);te(V,{accent:!0,className:"text-light-card-1 dark:text-dark-card-1 w-80 max-w-full",onclick:B,children:(r,y)=>{L();var k=X("Log in");w(r,k)},$$slots:{default:!0}}),O(M),w(s,g)},$$slots:{default:!0}});var D=d(S,2);W(D,{className:"flex flex-col items-center justify-center gap-4",children:(s,_)=>{var g=be();L(2),w(s,g)},$$slots:{default:!0}});var J=d(D,2);oe(J,{}),w(n,N),G()}export{Ke as component};
