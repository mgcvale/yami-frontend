var w=(r,u,o)=>new Promise((i,e)=>{var d=n=>{try{c(o.next(n))}catch(g){e(g)}},p=n=>{try{c(o.throw(n))}catch(g){e(g)}},c=n=>n.done?i(n.value):Promise.resolve(n.value).then(d,p);c((o=o.apply(r,u)).next())});import"../chunks/COm6N4YE.js";import{p as W,f as k,a as P,b as x,c as G,d as A,s as f,r as L,o as s,m,l as a,X as H,n as O,V,W as R}from"../chunks/FcNz6uVe.js";import{a as S,b as X,c as q,B as z}from"../chunks/Dx98FtbP.js";import{C as U}from"../chunks/Bm_8EKST.js";import{L as K}from"../chunks/CQ_J3efe.js";import{T as _}from"../chunks/CAS4DjvC.js";import{M as Q}from"../chunks/BQspDZ5E.js";import{g as Z}from"../chunks/QXgKwo3K.js";import{c as C,e as ee,f as re,i as te}from"../chunks/tpmtnrJv.js";import{D as ae}from"../chunks/D4ODo2ld.js";import{a as se}from"../chunks/BqIH7s4d.js";import{c as oe}from"../chunks/BWmCwwzs.js";import{E as ne,a as le}from"../chunks/i4bjYeuP.js";function ie(r){return typeof r=="object"&&r!==null&&typeof r.accessToken=="string"&&typeof r.id=="number"&&typeof r.username=="string"&&typeof r.email=="string"&&typeof r.followerCount=="number"&&typeof r.followingCount=="number"&&typeof r.reviewCount=="number"}function ue(r,u,o){return r.length===0?["You must provide a username","","",!1]:r.length<3?["The username must be at least 3 characters long","","",!1]:r.length>31?["The username must be at most 32 characters long","","",!1]:u.length===0?["","You must provide an email","",!1]:u.match(C.emailRegex)?o.length===0?["","","You must provide a password",!1]:o.length<8?["","","Your password must have at least 8 characters",!1]:["","","",!0]:["","You must provide a valid email","",!1]}function ce(r,u,o){return w(this,null,function*(){let i=["","",""];try{const e=yield ee(yield re(C.apiPaths.user(),{method:"POST",body:JSON.stringify({username:r,password:o,email:u.toLowerCase()})},C.fetchTimeout));if(console.log("Create account response: ",e),!ie(e))return S(ae.BAD_RESPONSE),i;se.set("accessToken",e.accessToken,{expires:180}),oe.set({loading:!1,data:{id:e.id,username:e.username,accessToken:e.accessToken,email:e.email,bio:"",location:"",followerCount:e.followerCount,followingCount:e.followingCount,reviewCount:e.reviewCount,following:!1},error:null}),Z("/account/details")}catch(e){if(te(e)){if(e.status===409)return console.log("status was 409"),["This username is already in use","",""];S(e)}else e instanceof TypeError?X():q(e)}return i})}var fe=k('<header class="flex flex-col align-center justify-center h-14"><!></header> <div class="flex flex-col gap-4 items-center mt-4 mb-1"><h2 class="font-alegreya text-2xl">Create an account</h2> <!> <!> <!> <!></div>',1),me=k(`<div class="items-center text-center"><p>Already have an account?</p> <a href="/account/login" class="underline text-light-fg-100 dark:text-dark-fg-100">Log-in instead</a></div> <div class="items-center text-center"><p>Don't want to log in?</p> <a href="/app" class="underline text-light-fg-100 dark:text-dark-fg-100">Return to yami</a></div>`,1),de=k("<!> <!> <!>",1);function Ne(r,u){W(u,!0);let o=m(""),i=m(""),e=m(""),d=m(""),p=m(""),c=m(""),n=m(!0),g=H(()=>a(n)?ne:le);const Y=()=>{s(n,!a(n))};function I(){return w(this,null,function*(){let h;(v=>{var l=R(v,4);s(i,l[0],!0),s(d,l[1],!0),s(c,l[2],!0),h=l[3]})(ue(a(o),a(e),a(p))),h&&(yield(v=>w(null,null,function*(){var l=R(v,3);s(i,l[0],!0),s(d,l[1],!0),s(c,l[2],!0)}))(yield ce(a(o),a(e),a(p))))})}var T=de(),$=P(T);U($,{children:(h,v)=>{var l=fe(),y=P(l),B=A(y);K(B,{className:"w-full h-auto"}),L(y);var b=f(y,2),M=f(A(b),2);_(M,{placeholder:"Username",maxLength:31,className:"w-80 max-w-full",noDecoration:"true",get value(){return a(o)},set value(t){s(o,t,!0)},get errorMessage(){return a(i)},set errorMessage(t){s(i,t,!0)}});var N=f(M,2);_(N,{placeholder:"Email",className:"w-80 max-w-full",noDecoration:"true",get value(){return a(e)},set value(t){s(e,t,!0)},get errorMessage(){return a(d)},set errorMessage(t){s(d,t,!0)}});var D=f(N,2);_(D,{placeholder:"Password",className:"w-80 max-w-full",noDecoration:"true",onIconClick:Y,get value(){return a(p)},set value(t){s(p,t,!0)},get password(){return a(n)},set password(t){s(n,t,!0)},get icon(){return a(g)},set icon(t){s(g,t,!0)},get errorMessage(){return a(c)},set errorMessage(t){s(c,t,!0)}});var F=f(D,2);z(F,{accent:!0,className:"text-light-card-1 dark:text-dark-card-1 w-80 max-w-full",onclick:I,children:(t,pe)=>{O();var J=V("Create account");x(t,J)},$$slots:{default:!0}}),L(b),x(h,l)},$$slots:{default:!0}});var E=f($,2);U(E,{className:"flex flex-col items-center justify-center gap-4",children:(h,v)=>{var l=me();O(2),x(h,l)},$$slots:{default:!0}});var j=f(E,2);Q(j,{}),x(r,T),G()}export{Ne as component};
