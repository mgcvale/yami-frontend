var A=(d,t,s)=>new Promise((i,m)=>{var b=n=>{try{F(s.next(n))}catch(y){m(y)}},S=n=>{try{F(s.throw(n))}catch(y){m(y)}},F=n=>n.done?i(n.value):Promise.resolve(n.value).then(b,S);F((s=s.apply(d,t)).next())});import{m as Ke,X as qe,g as he,b as Je,d as Ve,e as Xe,f as Qe,c as ce,a as ye,i as We,s as Ye}from"../chunks/tpmtnrJv.js";import{t as Se,b as Ne,f as Te}from"../chunks/BQspDZ5E.js";import"../chunks/COm6N4YE.js";import{L as Ge}from"../chunks/vsAJmYaO.js";import{l as He}from"../chunks/DN7I8fko.js";import{l as Ze,a as $e}from"../chunks/D81uzl0O.js";import{s as z,o as et}from"../chunks/CQT1G1Sl.js";import{p as Pe,m as k,k as Ue,O as je,f as O,a as ee,t as K,b as p,c as Ae,s as R,d as c,l as e,r as l,o,n as fe,h as _e,V as Ee,X as xe}from"../chunks/FcNz6uVe.js";import{P as tt}from"../chunks/DH25bUqh.js";import{i as at,S as rt,E as we}from"../chunks/BtRaPuvF.js";import{s as ot}from"../chunks/CymkjPvo.js";import{i as q}from"../chunks/7ms9Oyq9.js";import{s as Le,a as st}from"../chunks/Cb4E-4CT.js";import{d as nt,g as it}from"../chunks/BsEKk5dv.js";import{b as lt}from"../chunks/nfhiTeln.js";import{p as L}from"../chunks/BdHP4ea0.js";import{T as De}from"../chunks/CAS4DjvC.js";import{S as Oe}from"../chunks/BiDXjf4q.js";import{h as dt,B as ut}from"../chunks/Dx98FtbP.js";import{c as ct}from"../chunks/BWmCwwzs.js";import{D as Ce,C as ft}from"../chunks/D4ODo2ld.js";import{s as be}from"../chunks/Bya-iZhh.js";import{g as vt}from"../chunks/QXgKwo3K.js";const mt=d=>A(null,null,function*(){var m,b,S,F,n,y,C,W;const{user:t}=yield d.parent();if(t===null){Ke.set({component:Ge,props:{actionName:"create a review"}});return}const s=parseInt((m=d.url.searchParams.get("restaurantId"))!=null?m:"-1"),i=parseInt((b=d.url.searchParams.get("foodId"))!=null?b:"-1");if(i!=-1){const g=yield He(i);return g.error!=null?{user:t,warning:"Error loading the food, continuing with no food"}:{user:t,food:g.data,restaurant:{id:(S=g.data)==null?void 0:S.restaurantId,name:(F=g.data)==null?void 0:F.restaurantName,shortName:(n=g.data)==null?void 0:n.restaurantShortName}}}else if(s!=-1){const g=yield Ze(s);return g.error!=null?(console.error(g.error),{user:t,warning:"Error loading the food, continuing with no food"}):{user:t,restaurant:{id:(y=g.data)==null?void 0:y.id,name:(C=g.data)==null?void 0:C.name,shortName:(W=g.data)==null?void 0:W.shortName}}}}),aa=Object.freeze(Object.defineProperty({__proto__:null,load:mt},Symbol.toStringTag,{value:"Module"}));var gt=(d,t)=>t(null),pt=O('<div class="fixed top-0 left-0 w-dvw h-dvh backdrop-blur-lg z-50"></div> <div class="h-10"></div>',1),ht=(d,t)=>t(null),_t=O('<button><span class="text-light-subaccent dark:text-dark-subaccent"> </span> <!></button>'),xt=(d,t)=>t(null),wt=O('<button class="w-full h-full flex justify-start items-center gap-2 max-h-12"><img class="max-w-12 aspect-square rounded-full"/> <span class="text-light-fg-500 dark:text-dark-fg-500 text-lg"> </span> <div class="grow"></div> <!></button>'),bt=O('<div class="m-auto"><span> <span></span></span></div>'),yt=O('<div class="m-auto"><span> </span></div>'),kt=O('<div class="m-auto"><span> </span></div>'),Ft=O('<div class="m-auto"><span> </span></div>'),Rt=(d,t,s)=>t(e(s)),St=O('<button class="w-full h-12 flex justify-start items-center p-2 bg-light-card-2 dark:bg-dark-card-2 rounded-md gap-2"><img class="h-full w-auto aspect-square rounded-full" alt="No image"/> <div class="flex flex-col justify-center items-start overflow-hidden"><span> </span> <span class="text-sm truncate overflow-ellipsis w-full pr-2 max-w-full"> </span></div></button>'),Nt=O('<div class="flex flex-col gap-2 py-1 px-0.5 justify-start items-center overflow-scroll max-h-120"></div>'),Tt=O("<!> <div><!> <!></div>",1);function Ie(d,t){Pe(t,!0);let s=L(t,"placeholder",3,"option"),i=L(t,"className",3,""),m=L(t,"selected",15,null),b=L(t,"fetchFunction",3,r=>A(null,null,function*(){return{data:null,error:null}})),S=L(t,"imageUrlFunction",3,r=>"url"),F=L(t,"disabled",11,!1),n=L(t,"searchOnKeydown",3,!1),y=L(t,"forceListUpdate",3,!1),C=L(t,"loading",15,!1),W=L(t,"loadingMessage",3,"Loading..."),g=L(t,"loadingControlledByComponent",3,!1),Y=k(null),D=k(""),N=k(!1),_=k(null);function J(r=null){!e(N)&&e(Y)?(o(_,e(Y).getBoundingClientRect(),!0),o(D,`position: fixed; width: ${e(_).width}px; height: ${e(_).height}px; top: ${e(_).top}px; left: ${e(_).left}px`),setTimeout(()=>{o(D,"position: fixed; max-width: 380px; width: 80dvw; height: auto; min-height: 40%; top: 50%; left: 50%; transform: translate(-50%, -50%);")},10)):e(N)&&(e(_)?(o(D,`position: fixed; max-width: ${e(_).width}px; width: ${e(_).width}px; max-height: ${e(_).height}px; top: ${e(_).top}px; left: ${e(_).left}px`),setTimeout(()=>{o(D,"position: relative")},300)):o(D,"position: relative")),m(r),o(N,!e(N))}let I=k(Ue({data:null,error:null})),G=k("");function H(){return A(this,null,function*(){g()&&C(!0),o(I,yield b()(e(G)),!0),console.log("DATA: ",e(I).data),g()&&C(!1)})}je(()=>{y()&&H()});function ne(r){J(r)}var te=Tt(),ae=ee(te);{var ve=r=>{var f=pt(),T=ee(f);T.__click=[gt,J],fe(2),Se(1,T,()=>Te,()=>({duration:200,easing:Ne(.1,.9,.1,.9)})),Se(2,T,()=>Te,()=>({duration:300,easing:Ne(.15,.55,.3,.8)})),p(r,f)};q(ae,r=>{e(N)&&r(ve)})}var a=R(ae,2),u=c(a);{var x=r=>{var f=_e(),T=ee(f);{var V=h=>{var v=_t();v.__click=[ht,J];var E=c(v),M=c(E);l(E);var B=R(E,2);Oe(B,{}),l(v),K(()=>{var U;Le(v,1,`w-full h-full flex justify-between max-h-12 ${F()?"opacity-30 pointer-events-none":""}`),z(M,`Select a ${(U=s())!=null?U:""}`)}),p(h,v)},oe=h=>{De(h,{onKeyPress:()=>{n()&&H()},get placeholder(){var v;return`Search for a ${(v=s())!=null?v:""}`},noDecoration:!0,get icon(){return Oe},onIconClick:H,onSubmit:H,get value(){return e(G)},set value(v){o(G,v,!0)}})};q(T,h=>{e(N)?h(oe,!1):h(V)})}p(r,f)},re=r=>{var f=wt();f.__click=[xt,J];var T=c(f),V=R(T,2),oe=c(V);l(V);var h=R(V,4);qe(h,{}),l(f),K(v=>{var E,M;he(T,"src",v),he(T,"alt",s()),z(oe,`${(E=s())!=null?E:""}: ${(M=m().text)!=null?M:""}`)},[()=>S()(m().id)]),p(r,f)};q(u,r=>{m()===null?r(x):r(re,!1)})}var w=R(u,2);{var P=r=>{var f=_e(),T=ee(f);{var V=h=>{var v=bt(),E=c(v),M=c(E,!0);fe(),l(E),l(v),K(()=>z(M,W())),p(h,v)},oe=(h,v)=>{{var E=B=>{var U=yt(),ie=c(U),me=c(ie);l(ie),l(U),K(()=>{var le;return z(me,`An error ocurred: ${(le=e(I).error.message)!=null?le:""}`)}),p(B,U)},M=B=>{var U=_e(),ie=ee(U);{var me=Z=>{var se=kt(),de=c(se),ge=c(de);l(de),l(se),K(()=>{var j;return z(ge,`Make a search to select a ${(j=s())!=null?j:""}.`)}),p(Z,se)},le=(Z,se)=>{{var de=j=>{var X=Ft(),ue=c(X),$=c(ue);l(ue),l(X),K(()=>{var Q;return z($,`No ${(Q=s())!=null?Q:""} was found with your search.`)}),p(j,X)},ge=j=>{var X=Nt();Je(X,21,()=>e(I).data,Ve,(ue,$)=>{var Q=St();Q.__click=[Rt,ne,$];var ke=c(Q),Fe=R(ke,2),pe=c(Fe),Me=c(pe,!0);l(pe);var Re=R(pe,2),Be=c(Re,!0);l(Re),l(Fe),l(Q),K(ze=>{he(ke,"src",ze),z(Me,e($).text),z(Be,e($).subtext)},[()=>S()(e($).id)]),p(ue,Q)}),l(X),p(j,X)};q(Z,j=>{e(I).data.length===0?j(de):j(ge,!1)},se)}};q(ie,Z=>{e(I).data?Z(le,!1):Z(me)})}p(B,U)};q(h,B=>{e(I).error!==null?B(E):B(M,!1)},v)}};q(T,h=>{C()?h(V):h(oe,!1)})}p(r,f)};q(w,r=>{e(N)&&r(P)})}l(a),lt(a,r=>o(Y,r),()=>e(Y)),K(()=>{var r;Le(a,1,`bg-light-field-bg dark:bg-dark-field-bg rounded-lg p-2 flex flex-col justify-start relative transition-all duration-300 ease-out ${e(N)?"z-60 shadow-xl":""} ${(r=i())!=null?r:""}`),st(a,e(D))}),p(d,te),Ae()}nt(["click"]);function Et(d,t,s){return A(this,null,function*(){try{const i=it(ct).data;if(!i)throw Ce.USER_NOT_LOADED;const m=yield Xe(yield Qe(ce.apiPaths.createFoodReview(d),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.accessToken}`},body:JSON.stringify({review:t,rating:s})},ce.fetchTimeout));if(!at(m))throw Ce.BAD_RESPONSE;return ye(m)}catch(i){return Lt(i)}})}function Lt(d){if(We(d))switch(d.status){case 409:return Ye({status:409,message:"It seems you already have a review for this food.",type:ft})}return dt(d)}var Ot=O('<!> <div class="flex flex-col mt-2 px-6 gap-3 grow"><!> <!> <!> <!> <div class="flex justify-end"><!></div></div>',1);function ra(d,t){Pe(t,!0);let s=k(null),i=k(null),m=xe(()=>e(s)===null),b=xe(()=>e(i)===null),S=k(""),F=k(5);je(()=>{e(s)===null?o(i,null):g()});let n=k(Ue({data:[],error:null})),y=k(!1),C=k(!1);const W=a=>A(null,null,function*(){const u=yield ot(a);return u.data!==null?{error:null,data:u.data.content.map(x=>({id:x.id,text:x.shortName,subtext:x.name}))}:u});function g(){return A(this,null,function*(){if(o(y,!0),!e(s)){o(n,ye([]),!0);return}const a=yield $e(e(s).id);if(a.data===null){o(n,a,!0);return}o(n,ye(a.data.map(u=>({id:u.id,text:u.name,subtext:u.description}))),!0),o(y,!1),o(C,!0),setTimeout(()=>o(C,!1))})}const Y=a=>A(null,null,function*(){if(!e(s))return{data:[],error:null};if(e(n).error!==null||e(n).data===null)return e(n);const u=a.toLowerCase().trim();if(!u)return{error:null,data:e(n).data};const x=w=>{w=w.toLowerCase();let P=0,r=0;for(let f=0;f<w.length&&r<u.length;f++)w[f]===u[r]&&(P+=10-f*.1,r++);return P+=r*5,P};return{error:null,data:e(n).data.map(w=>{var r;const P=w.text+" "+((r=w.subtext)!=null?r:"");return{item:w,score:x(P)}}).sort((w,P)=>P.score-w.score).map(w=>w.item)}}),D=a=>A(null,null,function*(){var x,re;if(!e(i)){be.set({component:we,props:{warningMessage:"You must select a food to post a review."}});return}const u=yield Et((x=e(i))==null?void 0:x.id,e(S),e(F)*2);if(u.error!=null){be.set({component:we,props:{warningMessage:u.error.message}});return}vt(`/app/food?id=${(re=e(i))==null?void 0:re.id}`)});et(()=>{t.data.restaurant&&o(s,{id:t.data.restaurant.id,text:t.data.restaurant.shortName,subtext:t.data.restaurant.name},!0),t.data.food&&o(i,{id:t.data.food.id,text:t.data.food.name,subtext:t.data.food.description},!0),t.data.warning&&be.set({component:we,props:{warningMessage:t.data.warning}})});var N=Ot(),_=ee(N);tt(_,{children:(a,u)=>{fe();var x=Ee("Create a review");p(a,x)},$$slots:{default:!0}});var J=R(_,2),I=c(J);Ie(I,{forceListUpdate:!1,searchOnKeydown:!1,disabled:!1,fetchFunction:W,get imageUrlFunction(){return ce.apiPaths.restaurantImage},placeholder:"Restaurant",className:"",get selected(){return e(s)},set selected(a){o(s,a,!0)}});var G=R(I,2);const H=xe(()=>{var a;return(a=e(s))==null?void 0:a.text});Ie(G,{get loadingMessage(){var a;return`Loading foods for ${(a=e(H))!=null?a:""}...`},get forceListUpdate(){return e(C)},searchOnKeydown:!0,fetchFunction:Y,get imageUrlFunction(){return ce.apiPaths.foodImage},placeholder:"Food",className:"",get loading(){return e(y)},set loading(a){o(y,a,!0)},get disabled(){return e(m)},set disabled(a){o(m,a,!0)},get selected(){return e(i)},set selected(a){o(i,a,!0)}});var ne=R(G,2);rt(ne,{name:"Rating",className:"mt-4",get disabled(){return e(b)},set disabled(a){o(b,a,!0)},get value(){return e(F)},set value(a){o(F,a,!0)}});var te=R(ne,2);De(te,{maxLength:256,textarea:!0,noDecoration:!0,placeholder:"Review (optional)",className:"grow",get disabled(){return e(b)},set disabled(a){o(b,a,!0)},get value(){return e(S)},set value(a){o(S,a,!0)}});var ae=R(te,2),ve=c(ae);ut(ve,{onclick:D,className:"py-1 px-4 mb-4",get disabled(){return e(b)},set disabled(a){o(b,a,!0)},children:(a,u)=>{fe();var x=Ee("Create Review");p(a,x)},$$slots:{default:!0}}),l(ae),l(J),p(d,N),Ae()}export{ra as component,aa as universal};
