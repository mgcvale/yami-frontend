var l=(t,o,e)=>new Promise((r,a)=>{var n=s=>{try{c(e.next(s))}catch(i){a(i)}},f=s=>{try{c(e.throw(s))}catch(i){a(i)}},c=s=>s.done?r(s.value):Promise.resolve(s.value).then(n,f);c((e=e.apply(t,o)).next())});import{c as m}from"../chunks/BWmCwwzs.js";import{g}from"../chunks/BsEKk5dv.js";import"../chunks/BQspDZ5E.js";import"../chunks/COm6N4YE.js";import"../chunks/vsAJmYaO.js";import{a as d,c as S,s as h,h as R}from"../chunks/tpmtnrJv.js";import{i as v}from"../chunks/B-3Zg4Vs.js";import{D as p,S as y}from"../chunks/D4ODo2ld.js";import{a as u}from"../chunks/BqIH7s4d.js";import{e as U}from"../chunks/C3_eTjx-.js";import{o as O}from"../chunks/CQT1G1Sl.js";import{p as T,f as _,g as E,b,c as k,d as w,r as I}from"../chunks/FcNz6uVe.js";import{l as N}from"../chunks/KtqtB2k4.js";import{i as j}from"../chunks/BDxfjx3K.js";function A(){return l(this,null,function*(){var e;const t=u.get("accessToken");if(!t)return localStorage.removeItem("currentUser"),{data:null,error:p.INVALID_TOKEN};const o=localStorage.getItem("currentUser");if(o)try{console.log("Recovered user from localStorage");const r=JSON.parse(o);if(v(r))return d(r)}catch(r){localStorage.removeItem("currentUser")}try{console.log("Fetching user");const r=yield fetch(S.apiPaths.login(),{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const n=yield r.json();throw{status:r.status,message:(e=n.message)!=null?e:"Server error",type:y}}const a=yield r.json();return localStorage.setItem("currentUser",JSON.stringify(a)),d(a)}catch(r){return r&&typeof r=="object"&&"status"in r?(u.remove("accessToken"),localStorage.removeItem("currentUser"),{data:null,error:r}):(console.error("Network error during authentication:",r),u.remove("accessToken"),localStorage.removeItem("currentUser"),h(p.NETWORK_ERROR))}})}const D=!1,F=!1,x=t=>l(null,null,function*(){const{depends:o}=t;o("user:current");const e=g(m);if(!e.loading&&e.data!==null)return{user:e.data};const r=yield A();if(r.data==null&&r.error!=null&&(console.log("ERROR LOADING USER: ",r.error.status),r.error.status!==401))throw U(r.error.status,r.error);return m.set(R(r.data)),{user:r.data}}),Z=Object.freeze(Object.defineProperty({__proto__:null,load:x,prerender:F,ssr:D},Symbol.toStringTag,{value:"Module"}));var z=_('<div class="yami-content h-full w-full max-w-[500px] bg-light-bg dark:bg-dark-bg"><!></div>');function $(t,o){T(o,!0);const e=!1;O(()=>{j(document),N(document)});var r=z(),a=w(r);return E(a,()=>o.children),I(r),b(t,r),k({prerender:e})}export{$ as component,Z as universal};
