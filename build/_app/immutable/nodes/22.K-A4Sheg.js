var ke=Object.defineProperty,ye=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var ge=(a,e,t)=>e in a?ke(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,X=(a,e)=>{for(var t in e||(e={}))Se.call(e,t)&&ge(a,t,e[t]);if(ve)for(var t of ve(e))Ce.call(e,t)&&ge(a,t,e[t]);return a},te=(a,e)=>ye(a,Ee(e));var U=(a,e,t)=>new Promise((s,n)=>{var r=d=>{try{f(t.next(d))}catch(k){n(k)}},_=d=>{try{f(t.throw(d))}catch(k){n(k)}},f=d=>d.done?s(d.value):Promise.resolve(d.value).then(r,_);f((t=t.apply(a,e)).next())});import"../chunks/COm6N4YE.js";import{o as ie,s as P}from"../chunks/CQT1G1Sl.js";import{p as Q,m as C,k as B,f as R,d as p,l as o,r as x,t as O,b as g,c as Z,o as m,s as c,a as H,h as xe,X as be,n as q,V as G,O as se}from"../chunks/FcNz6uVe.js";import{i as L}from"../chunks/7ms9Oyq9.js";import{p as z,a as Ne,b as Re}from"../chunks/BdHP4ea0.js";import{D as Fe}from"../chunks/CUUdhvzw.js";import{e as ue,f as ce,c as j,s as fe,a as de,b as Te,d as Ue,X as Ae,m as W}from"../chunks/tpmtnrJv.js";import{s as De}from"../chunks/Cb4E-4CT.js";import{i as Pe,E as re}from"../chunks/BtRaPuvF.js";import{i as Oe}from"../chunks/CqBOX26c.js";import{D as K}from"../chunks/D4ODo2ld.js";import{h as me,B as le}from"../chunks/Dx98FtbP.js";import{F as Le}from"../chunks/BlMnf9v-.js";import{R as Me}from"../chunks/VED0w991.js";import{c as Y}from"../chunks/BWmCwwzs.js";import{g as ne}from"../chunks/BsEKk5dv.js";import{s as ae}from"../chunks/Bya-iZhh.js";import{E as Ie}from"../chunks/B6OjRboD.js";import"../chunks/BQspDZ5E.js";import{L as Be}from"../chunks/vsAJmYaO.js";import{i as Ye,r as He,g as pe}from"../chunks/QXgKwo3K.js";import{P as je}from"../chunks/DH25bUqh.js";import{T as oe}from"../chunks/CAS4DjvC.js";import{i as $e}from"../chunks/B-3Zg4Vs.js";function ze(a){return U(this,null,function*(){try{const e=yield ue(yield ce(j.apiPaths.userReviews(a),{},j.fetchTimeout));return Oe(e,Pe)?de(e):fe(K.BAD_RESPONSE)}catch(e){return me(e)}})}var Je=R("<span>loading...</span>"),Ve=R('<h3 class="text-light-error dark:text-dark-error">An error occourred.</h3> <span> </span>',1),Xe=R("<div><!></div>");function qe(a,e){Q(e,!0);let t=C(!0),s=C(B({data:null,error:null})),n=z(e,"viewingSelf",3,!1),r=z(e,"className",3,"");const _=()=>U(null,null,function*(){m(t,!0),m(s,yield ze(e.userId),!0),m(t,!1)});ie(()=>U(null,null,function*(){return _()}));var f=Xe(),d=p(f);{var k=i=>{var E=Je();g(i,E)},w=(i,E)=>{{var F=u=>{var v=Ve(),S=c(H(v),2),h=p(S);x(S),O(()=>{var T;return P(h,`error: ${(T=o(s).error)!=null?T:""}`)}),g(u,v)},b=u=>{var v=xe(),S=H(v);Te(S,17,()=>o(s).data.content,Ue,(h,T)=>{Le(h,{get ownsReview(){return n()},get review(){return o(T)},collapsed:!1})}),g(u,v)};L(i,u=>{o(s).data===null?u(F):u(b,!1)},E)}};L(d,i=>{o(t)?i(k):i(w,!1)})}x(f),O(()=>{var i;return De(f,1,`flex flex-col w-full h-fit justify-start items-center gap-4 ${(i=r())!=null?i:""}`)}),g(a,f),Z()}function we(a,e,t){return U(this,null,function*(){const s=ne(Y);if(s.loading||s.data===null)return fe(K.USER_NOT_LOADED);try{yield ue(yield ce(j.apiPaths.follow(a),{method:e,headers:{Authorization:`Bearer ${s.data.accessToken}`}},j.fetchTimeout)),Ge(t)}catch(n){return me(n)}return de(null)})}function Ge(a){Y.update(e=>e.data?te(X({},e),{data:te(X({},e.data),{followingCount:e.data.followingCount+a})}):e)}const We=a=>we(a,"POST",1),Ke=a=>we(a,"DELETE",-1);var Qe=R('<span class="text-sm text-light-fg-700 dark:text-dark-fg-700">â€¢ From <span> </span></span>'),Ze=R('<!> <div class="flex flex-col justify-start items-start text-start mx-2"><h2 class="text-light-fg-50 dark:text-dark-fg-50 text-xl font-bold font-alegreya mx-1"> </h2> <h4 class="text-md font-dm-sans text-light-fg-500 dark:text-dark-fg-500 text-ms mx-1"> <!></h4> <!></div>',1);function et(a,e){Q(e,!0);const[t,s]=Re(),n=()=>Ne(Y,"$currentUserStore",t);let r=z(e,"user",15),_=z(e,"viewingSelf",3,!1),f=C(B(r().followerCount)),d=C(B(r().following));function k(){r(r().followerCount+=r().following?1:-1,!0),m(f,r().followerCount,!0),m(d,r().following,!0)}ie(()=>{console.log("USER ON UserHeader.svelte: ",r()),console.log("CURRENTUSER ON UserHeader.svelte: ",n().data)});let w=C(!1);function i(){return U(this,null,function*(){var v;if(console.log("Clicked user"),n().data===null){ae.set({component:re,props:{warningMessage:"You must be logged in to follow a user"}});return}if(r().id===((v=n().data)==null?void 0:v.id)){ae.set({component:re,props:{warningMessage:"You can't follow yourself"}});return}console.log("updated"),r(r().following=!r().following,!0),k(),m(w,!0),console.log("calling api");const u=r().following?yield We(r().id):yield Ke(r().id);console.log(u),u.error!==null&&(console.log("Error"),r(r().following=!r().following,!0),k(),ae.set({component:re,props:{warningMessage:`An error occurred: ${u.error.message}`}})),m(w,!1)})}var E=xe(),F=H(E);{var b=u=>{var v=Ze(),S=H(v);const h=be(()=>[{name:"Reviews",nameClassName:"text-ml",count:r().reviewCount,countClassName:"text-lg text-light-fg-hc dark:text-dark-fg-hc"},{name:"Followers",nameClassName:"text-light-fg-900 dark:text-dark-fg-900 text-sm",count:o(f),countClassName:"text-light-fg-700 dark:text-dark-fg-700 text-md",onClick:e.onFollowerClick},{name:"Following",nameClassName:"text-light-fg-900 dark:text-dark-fg-900 text-sm",count:r().followingCount,countClassName:"text-light-fg-700 dark:text-dark-fg-700 text-md",onClick:e.onFollowingClick}]);Ie(S,{className:"h-24",get name(){return r().username},get headers(){return o(h)},pictureUrl:"https://static.vecteezy.com/system/resources/previews/009/292/244/non_2x/default-avatar-icon-of-social-media-user-vector.jpg"});var T=c(S,2),M=p(T),ee=p(M);x(M);var $=c(M,2),l=p($),A=c(l);{var D=y=>{var N=Qe(),V=c(p(N)),I=p(V,!0);x(V),x(N),O(()=>P(I,r().location)),g(y,N)};L(A,y=>{r().location!==null&&r().location.trim()!==""&&y(D)})}x($);var J=c($,2);{var he=y=>{le(y,{get onclick(){return e.onEditClick},accent:!1,outline:!1,className:"w-full rounded-ml py-0.5 mt-2",children:(N,V)=>{q();var I=G("Edit profile");g(N,I)},$$slots:{default:!0}})},_e=y=>{le(y,{onclick:i,get accent(){return o(d)},get outline(){return o(d)},className:"w-full rounded-ml py-0.5 mt-2",children:(N,V)=>{q();var I=G();O(()=>P(I,o(d)?"Unfollow":"Follow")),g(N,I)},$$slots:{default:!0}})};L(J,y=>{_()?y(he):y(_e,!1)})}x(T),O(()=>{var y,N;P(ee,`@${(y=r().username)!=null?y:""}`),P(l,`${(N=r().bio)!=null?N:""} `)}),g(u,v)};L(F,u=>{r()&&u(b)})}g(a,E),Z(),s()}function tt(a,e,t){return U(this,null,function*(){if(ne(Y).data===null)return fe(K.USER_NOT_LOADED);try{const s={Authorization:`Bearer ${ne(Y).data.accessToken}`},n=yield ue(yield ce(j.apiPaths.user(),{method:"PATCH",headers:X({},s),body:JSON.stringify({bio:e,location:t,username:a})},j.fetchTimeout));if(!$e(n))throw K.BAD_RESPONSE;return Y.set({loading:!1,error:null,data:n}),localStorage.removeItem("currentUser"),Ye("user:current"),de(null)}catch(s){return me(s)}})}var rt=R('<span class="text-light-error dark:text-dark-error text-center pb-2"> </span>'),at=R('<!> <div class="flex justify-between px-2 py-1 pb-4"><!></div> <div class="flex flex-col gap-4"><div class="flex flex-col"><span class="pl-1">Your username</span> <!></div> <div class="flex flex-col"><span class="pl-1">Your bio</span> <!></div> <div class="flex flex-col pb-2"><span class="pl-1">Your location</span> <!></div> <!> <!></div>',1);function ot(a,e){Q(e,!0);let t=C(B(e.user.username)),s=C(B(e.user.bio)),n=C(B(e.user.location)),r=C(!0),_=C(""),f=C("");se(()=>{o(t)!=e.user.username?m(r,!1):o(s)!=e.user.bio?m(r,!1):o(n)!=e.user.location?m(r,!1):m(r,!0)}),se(()=>{o(t),m(_,"")});function d(){return U(this,null,function*(){const l=yield tt(o(t),o(s),o(n));l.error!==null?l.error.status===409?m(_,"This username is already in use!"):m(f,l.error.message,!0):(W.set(null),He())})}var k=at(),w=H(k);Ae(w,{class:"absolute cursor-pointer top-4 right-4",onclick:()=>W.set(null)});var i=c(w,2),E=p(i);je(E,{className:" p-0!",children:(l,A)=>{q();var D=G("Edit your profile");g(l,D)},$$slots:{default:!0}}),x(i);var F=c(i,2),b=p(F),u=c(p(b),2);oe(u,{placeholder:"username",get errorMessage(){return o(_)},noDecoration:!0,get value(){return o(t)},set value(l){m(t,l,!0)}}),x(b);var v=c(b,2),S=c(p(v),2);oe(S,{noDecoration:!0,placeholder:"bio",get value(){return o(s)},set value(l){m(s,l,!0)}}),x(v);var h=c(v,2),T=c(p(h),2);oe(T,{noDecoration:!0,placeholder:"location",get value(){return o(n)},set value(l){m(n,l,!0)}}),x(h);var M=c(h,2);{var ee=l=>{var A=rt(),D=p(A);x(A),O(()=>{var J;return P(D,`Error: ${(J=o(f))!=null?J:""}`)}),g(l,A)};L(M,l=>{o(f)&&o(f)!==""&&l(ee)})}var $=c(M,2);le($,{accent:!0,onclick:d,get disabled(){return o(r)},set disabled(l){m(r,l,!0)},children:(l,A)=>{q();var D=G("Update info");g(l,D)},$$slots:{default:!0}}),x(F),g(a,k),Z()}var st=R('<!> <!> <!> <h1 class="font-alegreya text-2xl text-left px-3 pt-1"> </h1> <!>',1),lt=R("<p>You must be logged in to view your profile.</p>"),nt=R('<div class="flex flex-col py-4 pt-6 px-2 gap-3 text-center"><!></div>');function Dt(a,e){Q(e,!0);let t=z(e,"data",7);ie(()=>{console.log("LOADED MAIN PAGE")}),se(()=>{!t().user&&t().viewingSelf&&W.set({component:Be,props:{actionName:"view your profile"}})});function s(){pe(`/app/user/followers?id=${t().userId}`)}function n(){pe(`/app/user/following?id=${t().userId}`)}function r(){W.set({component:ot,props:{user:t().user}})}var _=nt(),f=p(_);{var d=w=>{var i=st(),E=H(i);et(E,{onEditClick:r,onFollowerClick:s,onFollowingClick:n,get viewingSelf(){return t().viewingSelf},get user(){return t().user},set user(h){t().user=h}});var F=c(E,2);Me(F,{className:"p-2",get name(){return t().user.username},get stats(){return t().stats}});var b=c(F,2);Fe(b,{lineClassName:"bg-light-card-2 dark:bg-dark-card-2",containerClassName:"px-4"});var u=c(b,2),v=p(u);x(u);var S=c(u,2);qe(S,{get viewingSelf(){return t().viewingSelf},get userId(){return t().userId},className:"p-2 pt-0"}),O(()=>{var h;return P(v,`${(h=t().user.username)!=null?h:""}'s reviews`)}),g(w,i)},k=w=>{var i=lt();g(w,i)};L(f,w=>{t().user?w(d):w(k,!1)})}x(_),g(a,_),Z()}export{Dt as component};
